<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Login â€¢ MedAssist</title>
	<link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
	<div class="container" style="min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:24px;">
		<div style="text-align:center; margin-bottom:12px;">
			<h1 style="font-size:28px; font-weight:700; color:var(--text); margin:0 0 8px 0;">Welcome to Medical Diagnosis Chatbot</h1>
			<p style="color:var(--muted); font-size:16px; margin:0;">Your AI-powered medical assistant</p>
		</div>
		<div class="card" style="width:420px; max-width:100%;">
			<h2 class="title">Welcome back</h2>
			<p class="sub">Sign in to access your chats</p>
			<div class="form" style="margin-top:12px;">
				<input id="email" class="input" placeholder="Email" />
				<input id="password" class="input" type="password" placeholder="Password" />
				<button id="login" class="btn">Login</button>
				<a class="link" href="/register">Create an account</a>
			</div>
		</div>
	</div>
	<script>
	async function api(path, method='GET', body){
		const r = await fetch(path,{method,headers:{'Content-Type':'application/json'},body: body?JSON.stringify(body):undefined});
		return r.json();
	}
	
	async function handleLogin(){
		const emailInput = document.getElementById('email');
		const passwordInput = document.getElementById('password');
		const loginBtn = document.getElementById('login');
		
		const email = emailInput.value.trim();
		const password = passwordInput.value;
		
		if(!email || !password){
			alert('Please enter both email and password');
			return;
		}
		
		// Disable inputs and button, show loading message
		emailInput.disabled = true;
		passwordInput.disabled = true;
		loginBtn.disabled = true;
		const originalText = loginBtn.textContent;
		loginBtn.textContent = 'Logging in please wait...';
		
		try{
			const res = await api('/api/auth/login','POST',{email,password});
			if(res.access_token){ 
				localStorage.setItem('medassist_token',res.access_token); 
				localStorage.setItem('medassist_user',JSON.stringify(res.user)); 
				location.href='/home'; 
			}
			else{
				alert(res.error||'Login failed');
				// Re-enable inputs and button
				emailInput.disabled = false;
				passwordInput.disabled = false;
				loginBtn.disabled = false;
				loginBtn.textContent = originalText;
			}
		}catch(error){
			alert('An error occurred. Please try again.');
			// Re-enable inputs and button
			emailInput.disabled = false;
			passwordInput.disabled = false;
			loginBtn.disabled = false;
			loginBtn.textContent = originalText;
		}
	}
	
	document.getElementById('login').onclick = handleLogin;
	
	// Add Enter key support
	document.getElementById('email').addEventListener('keydown', (e) => {
		if(e.key === 'Enter'){
			document.getElementById('password').focus();
		}
	});
	
	document.getElementById('password').addEventListener('keydown', (e) => {
		if(e.key === 'Enter'){
			e.preventDefault();
			handleLogin();
		}
	});
	</script>
</body>
</html>
